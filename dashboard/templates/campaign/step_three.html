{% extends "layout.html" %}
{% from 'macros.html' import render_page_title, render_campaign_steps, render_form, render_campaign_steps_search_engine %}

{% block title %}
    {{ configs.page_title | default_title }}
{% endblock %}

{% block css %}
{% endblock %}

{% block content %}
    {{ render_page_title(configs.module, configs.url_index, configs.action) }}

    {% if configs.campaign_type_name == 'banner' or configs.campaign_type_name == 'mobile' or configs.campaign_type_name == 'native' or configs.campaign_type_name == 'iframe' %}
        {{ render_campaign_steps(configs.campaign_id,'active','active','current','','','','') }}
    {% elif configs.campaign_type_name == 'search_engine' %}
        {{ render_campaign_steps_search_engine(configs.campaign_id,'active','active','current','','','','') }}
    {% endif %}


    <!-- BEGIN BASIC FORM ELEMENTS-->
    <div class="row">
        <div class="col-md-12">
            <div class="grid simple">
                <div class="grid-title no-border">
                    <h4>بودجه بندی</h4>

                    <div class="tools">
                        <a href="javascript:;" class="collapse"></a>
                        <a href="#grid-config" data-toggle="modal" class="config"></a>
                        <a href="javascript:;" class="reload"></a>
                        <a href="javascript:;" class="remove"></a>
                    </div>
                </div>
                <div class="grid-body no-border">
                    <br>

                    <div class="col-md-6 col-sm-6 col-xs-6">
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">

                        {{ render_form(form, action_url=url_for(configs.url, campaign_id=configs.campaign_id, campaign_step=configs.campaign_step), action_text='ثبت و ادامه' ,btn_class='btn btn-primary btn-cons') }}

                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- END BASIC FORM ELEMENTS-->
{% endblock %}

{% block js %}
    <script type="text/javascript">
        $(document).ready(function () {
            function commaSeparateNumber(val) {
                while (/(\d+)(\d{3})/.test(val.toString())) {
                    val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
                }
                return val;
            }

            validateNumber = function (element, value) {
                if (! /^\d+$/.test(value)){
                    var icon = $(element).parent('.input-with-icon').children('i');
                    var parent = $(element).parent('.input-with-icon');
                    icon.removeClass('fa fa-check').addClass('fa fa-exclamation');
                    parent.removeClass('success-control').addClass('error-control');
                     $("form button").prop("disabled", true);
                }else{
                    var icon = $(element).parent('.input-with-icon').children('i');
                    var parent = $(element).parent('.input-with-icon');
                    icon.removeClass("fa fa-exclamation").addClass('fa fa-check');
                    parent.removeClass('error-control').addClass('success-control');
                    $("form button").prop("disabled", false);
                }
            };

            $("#total_budget").keyup(function () {
                var noCommas = $(this).val().replace(/,/g, '');
                validateNumber(this, noCommas);
                $(this).val(commaSeparateNumber(noCommas));
            });
            $("#daily_budget").keyup(function () {
                var noCommas = $(this).val().replace(/,/g, '');
                validateNumber(this, noCommas);
                $(this).val(commaSeparateNumber(noCommas));
            });
            $("#total_budget").val(commaSeparateNumber($("#total_budget").val()));
            $("#daily_budget").val(commaSeparateNumber($("#daily_budget").val()));
        });
    </script>
{% endblock %}